<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, target-densitydpi=medium-dpi"/>
    <title>main</title>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <style type="text/css">
        @font-face {
            font-family: 'Noto Sans KR Light';
            font-style: normal;
            font-weight: 300;
            src: url(./font/NotoSansKR-Light.woff2) format('woff2'),
                url(./font/NotoSansKR-Light.woff) format('woff'),
                url(./font/NotoSansKR-Light.otf) format('opentype');
        }

        @font-face {
            font-family: 'Noto Sans KR Regular';
            font-style: normal;
            font-weight: 400;
            src: url(./font/NotoSansKR-Regular.woff2) format('woff2'),
                url(./font/NotoSansKR-Regular.woff) format('woff'),
                url(./font/NotoSansKR-Regular.otf) format('opentype');
        }

        @font-face {
            font-family: 'Noto Sans KR Medium';
            font-style: normal;
            font-weight: 500;
            src: url(./font/NotoSansKR-Medium.woff2) format('woff2'),
                url(./font/NotoSansKR-Medium.woff) format('woff'),
                url(./font/NotoSansKR-Medium.otf) format('opentype');
        }

        @font-face {
            font-family: 'Noto Sans KR Bold';
            font-style: normal;
            font-weight: 700;
            src: url(./font/NotoSansKR-Bold.woff2) format('woff2'),
                url(./font/NotoSansKR-Bold.woff) format('woff'),
                url(./font/NotoSansKR-Bold.otf) format('opentype');
        }

        :root {
            --animate-duration: 0.2s;
        }

        html,
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            margin: 0;
            overflow: hidden;
        }
    
        #wrap {
            position: relative;
            max-width: 420px;
            min-width: 300px;
            max-height: 850px;
            min-height: 550px;
            width: 100%;
            height: 100%;
            background: rgb(255, 255, 255);
        }

        #blankSpace {
            position: absolute;
            width: 100%; 
			height: 100%;
			margin: 0%;
            z-index: 1; 
            opacity: 0;
            background-color: rgb(255, 255, 255);
			visibility: visible;
        }

        #blankSpace2 {
            position: absolute;
            width: 100%; 
			height: 100%;
			margin: 0%;
            z-index: 1; 
            opacity: 0;
            background-color: rgb(255, 255, 255);
			visibility: hidden;
        }

        #backGround {
            position: absolute;
            width: 100%; 
			height: 100%;
			margin: 0%;
            z-index: 1; 
            opacity: 0.7;
            background-color: black;
			visibility: hidden;
        }

        #mainTutorial1 {
            position: absolute;
            width: 100%; 
			height: 100%;
			margin: 0%;
            text-align: center;
            z-index: 1; 
            opacity: 0.7;
            background-color: black;
			visibility: hidden;
        }

        #mainTutorial2 {
            position: absolute;
            width: 100%; 
			height: 100%;
			margin: 0%;
            text-align: center;
            z-index: 1; 
            opacity: 0.7;
            background-color: black;
			visibility: hidden;
        }

        #recordTutorial1 {
            position: absolute;
            width: 100%; 
			height: 100%;
			margin: 0%;
            text-align: center;
            z-index: 1; 
            opacity: 0.7;
            background-color: black;
			visibility: hidden;
        }

        #recordTutorial2 {
            position: absolute;
            width: 100%; 
			height: 100%;
			margin: 0%;
            text-align: center;
            z-index: 1; 
            opacity: 0.7;
            background-color: black;
			visibility: hidden;
        }

        #recordTutorial3 {
            position: absolute;
            width: 100%; 
			height: 100%;
			margin: 0%;
            text-align: center;
            z-index: 1; 
            opacity: 0.7;
            background-color: black;
			visibility: hidden;
        }

        #tutorialWord {
            position: relative;
            top: 40%;
            font-family: 'Noto Sans KR Bold';
            font-size: 20px;
            line-height: 35px;
            color: white;
        }

        #uploadbutton {
            position: absolute;
            top: 3%;
            left: 5%;
            width: 13%;
            height: 35px;
            text-align: center;
            font-size: 15px;
            font-weight: bold;
            line-height: 34px;
		    color: rgb(0, 0, 0);
            background-color: #F5F5F5;
            border: none;
            border-radius: 30px;
            box-shadow: 0 1px 2px 0 rgba(0,0,0,0.2), 0 0.7px 2.5px 0 rgba(0,0,0,0.19);
            visibility: visible;
        }

        #filebox {
            position: absolute;
            top: 35%;
            left: 5%;
            width: 90%;
            height: 30%;
            padding-top: 5%;
            z-index: 1;
            align-items: center;
            text-align: center;
            font-family: 'Noto Sans KR Regular';
            font-size: 18px;
            line-height: 40px;
            background-color:white;
            border-radius: 30px;
            visibility: hidden;
        }

        #recordpausebutton {
            position: absolute;
            top: 10%;
            left: 44%;
            width: 12%;
            padding: 0%;
            border: none;
            background-color: rgba(255, 255, 255, 0);
            visibility: hidden;
        }
        #recordpausebutton img { margin: 0%; width: 100%;}

        #recordresumebutton {
            position: absolute;
            top: 10%;
            left: 44%;
            width: 12%;
            padding: 0%;
            border: none;
            background-color: rgba(255, 255, 255, 0);
            visibility: hidden;
        }
        #recordresumebutton img { margin: 0%; width: 100%;}
        
        #deletebuttonIcon {
            position: absolute;
            top: 10%;
            left: 45%;
            width: 10%;
            padding: 0%;
            border: none;
            background-color: rgba(255, 255, 255, 0);
            visibility: hidden;
        }
        #deletebuttonIcon img { margin: 0%; width: 100%;}

        #recordfinishpop {
            position: absolute;
            top: -5%;
            left: 5%;
            width: 80%;
            height: 45%;
            padding: 5%;
            padding-top: 10%;
            z-index: 0.9;
            text-align: center;
            font-family: 'Noto Sans KR Regular';
            font-size: 18px;
            line-height: 40px;
            background-color:white;
            border: none;
            border-radius: 30px;
            box-shadow: 0 1px 2px 0 rgba(0,0,0,0.2), 0 0.7px 2.5px 0 rgba(0,0,0,0.19);
            visibility: hidden;
        }

        #recordfinishpop button {
            position: absolute;
            top: 85%;
            width: 25%;
            height: 35px;
            font-family: 'Noto Sans KR Light';
            font-size: 14px;
            border: none;
            border-radius: 30px;
        }

        #uploadCheckPop {
            position: absolute;
            top: 35%;
            left: 5%;
            width: 90%;
            height: 30%;
            padding-top: 5%;
            z-index: 1;
            text-align: center;
            font-family: 'Noto Sans KR Regular';
            font-size: 18px;
            line-height: 40px;
            background-color:white;
            border-radius: 30px;
            visibility: hidden;
        }

        #uploadCheckPop button {
            position: absolute;
            bottom: 10%;
            width: 25%;
            height: 35px;
            font-family: 'Noto Sans KR Light';
            font-size: 14px;
            border: none;
            border-radius: 30px;
        }

        #deletePop {
            position: absolute;
            top: 35%;
            left: 5%;
            width: 90%;
            height: 30%;
            padding-top: 5%;
            z-index: 1;
            text-align: center;
            font-family: 'Noto Sans KR Regular';
            font-size: 18px;
            line-height: 40px;
            background-color:white;
            border-radius: 30px;
            visibility: hidden;
        }

        #deletePop button {
            position: absolute;
            bottom: 10%;
            width: 25%;
            height: 35px;
            font-family: 'Noto Sans KR Light';
            font-size: 14px;
            border: none;
            border-radius: 30px;
        }

        #timerPosition {
            position: absolute;
            top: 27%;
            width: 100%;
            align-items: center;
            text-align: center;
            font-family: 'Noto Sans KR Light';
            font-size: 19px;
            visibility: hidden;
        }

        #waterdrop {
            position: absolute;
            top: 32%;
            left: 30%;
            width: 40%;
            visibility: visible;
        }
        #waterdropIng {
            position: absolute;
            top: 32%;
            left: 30%;
            width: 40%;
            visibility: hidden;
        }

        #playbutton {
            width: 100%;
            padding: 0%;
            border: none;
            background-color: rgba(255, 255, 255, 0);
            visibility: hidden;
        }
        #playbutton img { margin: 0%; width: 100%;}

        #pausebutton {
            position: absolute;
            top: 32%;
            left: 30%;
            width: 40%;
            padding: 0%;
            border: none;
            background-color: rgba(255, 255, 255, 0);
            visibility: hidden;
        }
        #pausebutton img { margin: 0%; width: 100%;}

        .swiper-container {
            position: absolute;
            top: 32%;
            left: 30%;
            width: 40%;
            height: 68%;
            font-size: 0px;
        }

        #dragdirection {
            position: absolute;
            top: 60%;
            left: 49.1%;
            width: 1.8%;
            visibility: hidden;
        }

        #dragposition {
            position: absolute;
            bottom: 3%;
            left: 30%;
            width: 40%;
            visibility: hidden;
        }

        #dragup {
            position: absolute;
            width: 100%;
            height: 100%;
            bottom: -100%;
            opacity: 0.7;
        }

        #dragwaterdrop {
            position: absolute;
            width: 40%;
            left: 30%;
            bottom: 3%;
            visibility: hidden;
        }

        #recordbutton {
            position: absolute;
            bottom: 10%;
            left: 41%;
            width: 18%;
            padding: 0%;
            border: none;
            background-color: rgba(255, 255, 255, 0);
            visibility: visible;
        }
        #recordbutton img { margin: 0%; width: 100%;}

        #stopbutton {
            position: absolute;
            bottom: 10%;
            left: 41%;
            width: 18%;
            padding: 0%;
            border: none;
            background-color: rgba(255, 255, 255, 0);
            visibility: hidden;
        }
        #stopbutton img { margin: 0%; width: 100%;}

        #uploading {
            position: absolute;
            top: 32%;
            left: 27%;
            width: 46%;
            padding: 0%;
            z-index: 1;
            border: none;
            text-align: center;
            font-family: 'Noto Sans KR Medium';
            font-size: 28px;
            color: #F0B24C;
            background-color: rgba(255, 255, 255, 0);
            visibility: hidden;
        }
    </style>
</head>
<body onload="alert('녹음권한을 허용해야 숨을 이용할 수 있습니다.');">
    <div id="wrap">
        <div id="backGround"></div>
        <div id="blankSpace" onclick="blankSpaceDel()"></div>
        
        <!--튜토리얼-->
        <div id="mainTutorial1" onclick="mainTutorial1Del()">
            <p id="tutorialWord">녹음 버튼을 눌러 녹음<br>(최대 10분 녹음 가능)</p>
            <img style="position:absolute; bottom: 10.5%; left: 41%; width: 18%; border-radius: 70%; opacity: 1;"
                src="./img/button_record.png" alt="record button img">
        </div>
        <div id="mainTutorial2" onclick="mainTutorial2Del()">
            <label style="position: absolute;top: 3%;left: 5%;width: 13%;height: 35px;text-align: center;font-size: 15px;font-weight: bold;line-height: 34px;
		            color: rgb(0, 0, 0);background-color: #F5F5F5;border: none;border-radius: 30px;">+</label>
            <!--
            <button style="position: absolute; top: 3%; left: 5%; width: 13%; height: 35px; text-align: center; font-size: 15px; color: rgb(0, 0, 0); background-color: #F5F5F5;
                    border: none; border-radius: 30px;">+</button>
            -->
            <p id="tutorialWord">+ 버튼을 눌러 파일 불러오기<br>(10분 정도의 녹음파일 가능)</p>
        </div>
        <div id="blankSpace2" onclick="blankSpace2Del()"></div>
        <div id="recordTutorial1" onclick="recordTutorial1Del()">
            <p style="position:relative; top: 20%; font-family: 'Noto Sans KR Bold'; font-size: 20px; line-height: 35px; color: white;">재생 버튼을 눌러 다시 듣기</p>
            <img style="position: absolute; top: 32%; left: 30%; width: 40%; background-color: rgba(255, 255, 255, 0);" src="./img/recordtutorial_play.png" alt="play button"> 
        </div>
        <div id="recordTutorial2" onclick="recordTutorial2Del()">
            <p style="position:relative; top: 18%; font-family: 'Noto Sans KR Bold'; font-size: 20px; line-height: 35px; color: white;">아래로 드래그해서<br>스티커에 소리 저장하기</p>
            <img style="position: absolute; top: 32%; left: 30%; width: 40%;" src="./img/waterdrop_playbutton.png" alt="play button"> 
        </div>
        <div id="recordTutorial3" onclick="recordTutorial3Del()">
            <img style="position: absolute; top: 10%; left: 45%; width: 10%;" src="./img/button_delete.png" alt="delete button img">
            <p style="position:relative; top: 18%; font-family: 'Noto Sans KR Bold'; font-size: 20px; line-height: 35px; color: white;">휴지통을 클릭해서<br>삭제 후 재녹음하기</p> 
        </div>

        <!--업로드-->
        <form name="tempUploadForm" method="post" enctype="multipart/form-data">
            <label id="uploadbutton" for="audio_file" onclick="showFilebox()">+</label>
            <div id="filebox" class="popUpFile">
                <div style="width: 260px; height: 40px; margin-left: 30px; margin-top: 10%; margin-bottom: 20%; font-size: 18px; overflow: hidden;">
                    <input type="file" id="audio_file" accept="audio/*" style="width: 260px;">
                </div>
                <label onclick="closeFilebox()" style="position: absolute; left: 12%; bottom: 20%; width: 25%; height: 35px; font-family: 'Noto Sans KR Light'; font-size: 14px;
                    border: none; border-radius: 30px; color: rgb(0, 0, 0); background-color: #ececec;">취소</label>
                <input type="button" value="첨부" style="position: absolute; right: 12%; bottom: 20%; width: 25%; height: 35px; font-family: 'Noto Sans KR Light'; font-size: 14px;
                    border: none; border-radius: 30px; color: rgb(255, 255, 255); background-color: #F0B24C;"
                    onclick="tempUpload()">
            </div>
        </form>

        <!--드래그-->
        <img id="dragup" src="./img/drag_on.png" alt="drag on">
        <img id="dragwaterdrop" src="./img/waterdrop_playbutton.png" alt="play button img">
        <img id="dragdirection" src="./img/direction_dropdown.png" alt="drop down direction img">
        <img id="dragposition" src="./img/waterdrop_dropdown.png" alt="drop down position">

        <div id="swiperDiv" class="swiper-container" style="visibility: hidden;">
            <div class="swiper-wrapper">
                <div class="swiper-slide">
                </div>
                <div class="swiper-slide">
                    <button id="playbutton" class="play"><img src="./img/waterdrop_playbutton.png" alt="water drop play img"></button>
                </div>
            </div>
        </div>

        <div id="timerPosition"><span id="timer">00:00</span></div>
        <img id="waterdrop" src="./img/waterdrop_blank.png" alt="water drop blank img">
        <img id="waterdropIng" src="./img/record_ing.gif" alt="recording img">
        <audio class="record-audio"></audio>

        <!--버튼-->
        <button id="pausebutton" class="pause"><img src="./img/waterdrop_pausebutton.png" alt="water drop pause img"></button>
        <button id="recordbutton" class="record"><img src="./img/button_record.png" alt="record button img"></button>
        <button id="stopbutton" class="stop"><img src="./img/button_stop.png" alt="stop button img"></button>
        <button id="recordpausebutton" class="recordpause"><img src="./img/button_pause.png" alt="pause button img"></button>
        <button id="recordresumebutton" class="recordresume"><img src="./img/button_resume.png" alt="resume button img"></button>
        <button id="deletebuttonIcon" onclick="openDeletePop()"><img src="./img/button_delete.png" alt="delete button img"></button>

        <!--레코드 완료-->
        <div id="recordfinishpop" class="popDown">
            <br><h style="font-weight: bold; font-size: 28px;">녹음 완료</h><br>
            <P>녹음된 파일을 NFC 스티커에<br>업로드하시겠습니까?</P>
            <button onclick="openDeletePop()" style="left: 12%; background-color: #ececec;">재녹음</button>
            <button onclick="openUploadCheckPop()" style="right: 12%; color: rgb(255, 255, 255); background-color: #F0B24C;">업로드</button>
        </div>

        <!--업로드-->
        <div id="uploadCheckPop" class="popUpUpload">
            <p>스티커에 소리를 입히시겠습니까?<br>이후 새로운 소리를 입힐 수 없습니다.</p><br><br>
            <button onclick="closeUploadCheckPop()" style="left: 12%; color: rgb(0, 0, 0); background-color: #ececec;">취소</button>
            <button id="finalUploadButton" style="right: 12%; color: rgb(255, 255, 255); background-color: #F0B24C;">입히기</button>
        </div> 

        <div id="uploading">
            <img style="width: 100%;" src="./img/waterdrop_charge.gif" alt="uploading img">
            <p id="uploadProgress"></p>
        </div>

        <!--삭제-->
        <div id="deletePop" class="popUpDelete">
            <p>현재 녹음된 파일은 삭제됩니다.<br>그래도 재녹음 하시겠습니까?</p><br><br>
            <button onclick="closeDeletePop()" style="left: 12%; color: rgb(0, 0, 0); background-color: #ececec;">취소</button>
            <button id="deletebutton" class="delete" style="right: 12%; color: rgb(255, 255, 255); background-color: #F0B24C;">재녹음</button>
        </div>
    </div>

    <script src="https://unpkg.com/swiper/swiper-bundle.js"></script>
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <script>
        // 튜토리얼
        var tryNum = 0;

        function blankSpaceDel(){
            document.all.blankSpace.style.visibility="hidden";
            document.all.mainTutorial1.style.visibility="visible";
        }
        function mainTutorial1Del(){
            document.all.mainTutorial1.style.visibility="hidden";
            document.all.mainTutorial2.style.visibility="visible";
        }
        function mainTutorial2Del(){
            document.all.mainTutorial2.style.visibility="hidden";
        }

        function blankSpace2Del(){
            document.all.blankSpace2.style.visibility="hidden";
            document.all.recordTutorial1.style.visibility="visible";
        }
        function recordTutorial1Del(){
            document.all.recordTutorial1.style.visibility="hidden";
            document.all.recordTutorial2.style.visibility="visible";
        }
        function recordTutorial2Del(){
            document.all.recordTutorial2.style.visibility="hidden";
            document.all.recordTutorial3.style.visibility="visible";
        }
        function recordTutorial3Del(){
            document.all.recordTutorial3.style.visibility="hidden";
        }

        // 팝업 & 애니메이션
        const popUpFileElement = document.querySelector('.popUpFile');
        const popUpUploadElement = document.querySelector('.popUpUpload');
        const popUpDeleteElement = document.querySelector('.popUpDelete');
        const popDownElement = document.querySelector('.popDown');

        function showFilebox(){
            popUpFileElement.classList.add('animate__animated', 'animate__zoomIn');
            document.all.backGround.style.visibility="visible";
            document.all.filebox.style.visibility="visible";
        }
        function closeFilebox(){
            popUpFileElement.classList.remove('animate__animated', 'animate__zoomIn');
            document.all.backGround.style.visibility="hidden";
            document.all.filebox.style.visibility="hidden";
        }
        function openUploadCheckPop(){
            popUpUploadElement.classList.add('animate__animated', 'animate__zoomIn');
            document.all.backGround.style.visibility="visible";
            document.all.uploadCheckPop.style.visibility="visible";
        }
        function closeUploadCheckPop(){
            popUpUploadElement.classList.remove('animate__animated', 'animate__zoomIn');
            document.all.backGround.style.visibility="hidden";
            document.all.uploadCheckPop.style.visibility="hidden";
        }
        function openDeletePop(){
            popUpDeleteElement.classList.add('animate__animated', 'animate__zoomIn');
            document.all.backGround.style.visibility="visible";
            document.all.deletePop.style.visibility="visible";
        }
        function closeDeletePop(){
            popUpDeleteElement.classList.remove('animate__animated', 'animate__zoomIn');
            document.all.backGround.style.visibility="hidden";
            document.all.deletePop.style.visibility="hidden";
        }

        // 드래그 영역 생성
        const swiper = new Swiper('.swiper-container', {
            direction: 'vertical',
            loop: false,
            allowSlideNext: false,
            initialSlide: 1,
        });

        swiper.on('progress', function(){
            if(swiper.activeIndex == 1){
                if(swiper.progress==1){
                    document.all.timer.style.opacity = 1;
                    document.all.dragdirection.style.opacity = "1";
                }
                else if(swiper.progress<0.4){
                    //stop swiper
                }
                else{
                    document.all.timer.style.opacity = 0;
                    document.all.dragdirection.style.opacity = "0";
                }
                var varNum = -(swiper.progress*100);
                document.all.dragup.style.bottom = varNum+"%";
            }
        });

        swiper.on('slideChange', function(){
            if(swiper.activeIndex == 0){
                document.all.dragup.style.bottom = "-40%";
                document.all.timer.style.opacity = 0;
                document.all.dragwaterdrop.style.visibility = "visible";
                document.all.playbutton.style.visibility = "hidden";
                document.all.dragdirection.style.visibility = "hidden";
                document.all.dragposition.style.visibility = "hidden";

                document.all.recordfinishpop.style.visibility = "visible";
                popDownElement.classList.add('animate__animated', 'animate__fadeInDown');
            }
        });

        // 파일 업로드시 재생 및 입히기 기능
        function tempUpload(){
            /////////////////////////////////////////////////////////
            //파일 업로드 구현 하기
            //document.tempUploadForm.action = "업로드 액션";
            //document.tempUploadForm.submit();
            /////////////////////////////////////////////////////////

            // 화면 전환
            popUpFileElement.classList.remove('animate__animated', 'animate__zoomIn');
            document.all.backGround.style.visibility="hidden";
            document.all.filebox.style.visibility="hidden";
            document.all.uploadbutton.style.visibility="hidden";
            document.all.recordbutton.style.visibility="hidden";
            document.all.waterdrop.style.visibility="hidden";
            document.all.timer.style.visibility="visible";
            document.all.playbutton.style.visibility="visible";
            document.all.deletebuttonIcon.style.visibility="visible";
            document.all.swiperDiv.style.visibility="visible";
            document.all.dragdirection.style.visibility="visible";
            document.all.dragposition.style.visibility="visible";
            if(tryNum==0){
                document.all.blankSpace2.style.visibility="visible";
            }
            
            // 오디오 기능
            const audio = document.querySelector('.record-audio'); 

            audio.controls = false;
            // 오디오 파일 소스 불러오기
            //const audioURL = 서버의 오디오 파일 URL;
            const audioURL = "./img/TempVoice.oga";
            audio.src = audioURL;
            console.log("Temporary upload done! Audio activate!");

            playbutton.onclick = function (e) {
                this.currentTime = 0;
                audio.play();

                document.all.playbutton.style.visibility="hidden";
                document.all.pausebutton.style.visibility="visible";
            }

            pausebutton.onclick = function (e) {
                audio.pause();

                document.all.playbutton.style.visibility="visible";
                document.all.pausebutton.style.visibility="hidden";
            }

            /*
            audio.addEventListener('canplay', function(e){
                var audioTime = 오디오 타임 구하기;
                min = parseInt(audioTime/60);
                sec = audioTime%60;

                $("#timer").html(parseInt(min/10)+""+(min%10)+":"+parseInt(sec/10)+""+(sec%10));
            });
            */

            audio.addEventListener('timeupdate', function(e){
                var playtimeSec = Math.floor(audio.currentTime);
                var playtimeMin = parseInt(playtimeSec/60);
            
                $("#timer").html(parseInt(playtimeMin/10)+""+(playtimeMin%10)+":"+parseInt(playtimeSec/10)+""+(playtimeSec%10));
            }, false);

            audio.addEventListener('ended', function() { 
                document.all.playbutton.style.visibility="visible";
                document.all.pausebutton.style.visibility="hidden";
            }, false);

            finalUploadButton.onclick = function (e) {
                document.all.uploadCheckPop.style.visibility="hidden";
                document.all.uploading.style.visibility = "visible";

                /////////////////////////////////////////////
                // 서버에 업로드해야 하는 구역
                // audio.src 값이 오디오 소스값
                /////////////////////////////////////////////
                console.log("record file upload start");

                ////////////////////////////////////////////
                // 업로드 진행도는 실제 서버 작업할 때 수정하기
                var upProgress = 0;
                var UploadProgress = setInterval(function(){
                    $("#uploadProgress").html(upProgress+"%");
                    upProgress++;
                }, 17);

                setTimeout(function() {
                    clearInterval(UploadProgress);
                    setTimeout(function() {
                        console.log("record file upload done");
                        location.replace("./uploadDone.html");
                    }, 100);
                }, 1700);
                //////////////////////////////////////////////
            }

            deletebutton.onclick = function (e) {
                audio.src = "none";
                tryNum++;
                $("#timer").html("00:00");
                
                // 삭제 팝업 애니메이션 제거
                popUpFileElement.classList.remove('animate__animated', 'animate__zoomIn');
                popUpUploadElement.classList.remove('animate__animated', 'animate__zoomIn');
                popUpDeleteElement.classList.remove('animate__animated', 'animate__zoomIn');
                popDownElement.classList.remove('animate__animated', 'animate__fadeInDown');

                document.all.playbutton.style.visibility="hidden";
                document.all.pausebutton.style.visibility="hidden";
                document.all.deletePop.style.visibility="hidden";
                document.all.backGround.style.visibility="hidden";
                document.all.deletebuttonIcon.style.visibility="hidden";
                document.all.dragdirection.style.visibility="hidden";
                document.all.dragposition.style.visibility="hidden";
                document.all.waterdrop.style.visibility="visible";
                document.all.uploadbutton.style.visibility="visible";
                document.all.recordbutton.style.visibility="visible";
                document.all.recordpausebutton.style.visibility="hidden";
                document.all.stopbutton.style.visibility="hidden";
                document.all.timer.style.visibility="hidden";
                
                // 입히기 삭제 내용
                document.all.swiperDiv.style.visibility="hidden";
                document.all.dragup.style.bottom = "-100%";
                document.all.dragwaterdrop.style.visibility = "hidden";
                document.all.recordfinishpop.style.visibility = "hidden";
                document.all.timer.style.opacity = 1;

                swiper.activeIndex = 1;
                swiper.slideReset();

                console.log("record file deleted");
            }
        }

        // 녹음 기능
        var recordTimer = 0;
        var recordTime;
        var min = "";
        var sec = "";

        const record = document.querySelector('.record');
        const recordresume = document.querySelector('.recordresume');
        const recordpause = document.querySelector('.recordpause'); 
        const stop = document.querySelector('.stop');

        stop.disabled = true;
        
        let audioCtx;
    
        if (navigator.mediaDevices.getUserMedia) {
            console.log('getUserMedia supported.');

            const constraints = { audio: true };
            let chunks = [];

            let onSuccess = function (stream) {
                const mediaRecorder = new MediaRecorder(stream);

                record.onclick = function () {
                    mediaRecorder.start();
                    recordTime = 0;
                    min = "";
                    sec = "";

                    console.log(mediaRecorder.state);
                    console.log("recorder started");
                    
                    document.all.waterdrop.src="./img/record_start.gif";
                    document.all.uploadbutton.style.visibility="hidden";
                    document.all.recordbutton.style.visibility="hidden";
                    document.all.timer.style.visibility="visible";

                    recordTimer = setInterval(function(){
                        if(recordTime > 600) {
                            alert("Time Out!! 기능 추가 예정");
                        }
                        
                        min = parseInt(recordTime/60);
                        sec = recordTime%60;

                        $("#timer").html(parseInt(min/10)+""+(min%10)+":"+parseInt(sec/10)+""+(sec%10));
                        recordTime++;
                    }, 1000);

                    setTimeout(function() {
                        document.all.recordpausebutton.style.visibility="visible";
                        document.all.stopbutton.style.visibility="visible";
                        document.all.waterdrop.style.visibility = "hidden";
                        document.all.waterdropIng.style.visibility = "visible";
                        //document.all.waterdrop.src="./img/record_ing.gif";
                    }, 1310);

                    stop.disabled = false;
                    record.disabled = true;
                }

                recordpause.onclick = function () {
                    mediaRecorder.pause();
                    console.log(mediaRecorder.state);
                    console.log("recorder paused");

                    clearInterval(recordTimer);
                    
                    document.all.waterdrop.style.visibility = "visible";
                    document.all.waterdropIng.style.visibility = "hidden";
                    
                    document.all.waterdrop.src="./img/waterdrop_charge.png";
                    document.all.recordresumebutton.style.visibility="visible";
                    document.all.recordpausebutton.style.visibility="hidden";

                    stop.disabled = false;
                    record.disabled = true;
                }
                
                recordresume.onclick = function () {
                    mediaRecorder.resume();
                    console.log(mediaRecorder.state);
                    console.log("recorder resumed");

                    recordTimer = setInterval(function(){
                        min = parseInt(recordTime/60);
                        sec = recordTime%60;

                        $("#timer").html(parseInt(min/10)+""+(min%10)+":"+parseInt(sec/10)+""+(sec%10));
                        recordTime++;
                    }, 1000);
                    
                    document.all.waterdrop.style.visibility = "hidden";
                    document.all.waterdropIng.style.visibility = "visible";

                    document.all.waterdrop.src="./img/record_ing.gif";
                    document.all.recordresumebutton.style.visibility="hidden";
                    document.all.recordpausebutton.style.visibility="visible";

                    stop.disabled = false;
                    record.disabled = true;
                }

                stop.onclick = function () {
                    mediaRecorder.stop();
                    
                    console.log(mediaRecorder.state);
                    console.log("recorder stopped");
                    // mediaRecorder.requestData();
                    
                    clearInterval(recordTimer);

                    document.all.waterdropIng.style.visibility = "hidden";
                    document.all.waterdrop.src="./img/record_end.gif";
                    document.all.waterdrop.style.visibility = "visible";

                    document.all.recordpausebutton.style.visibility="hidden";
                    document.all.recordresumebutton.style.visibility="hidden";
                    document.all.stopbutton.style.visibility="hidden";

                    setTimeout(function() {
                        document.all.waterdrop.style.visibility="hidden";
                        document.all.waterdrop.src="./img/waterdrop_blank.png";
                        document.all.playbutton.style.visibility="visible";
                        document.all.deletebuttonIcon.style.visibility="visible";
                        document.all.swiperDiv.style.visibility="visible";
                        document.all.dragdirection.style.visibility="visible";
                        document.all.dragposition.style.visibility="visible";
                        if(tryNum==0){
                            document.all.blankSpace2.style.visibility="visible";
                        }
                    }, 1800);

                    stop.disabled = true;
                    record.disabled = false;
                }

                mediaRecorder.onstop = function (e) {
                    console.log("data available after MediaRecorder.stop() called.");

                    const audio = document.querySelector('.record-audio'); 

                    audio.controls = false;
                    const blob = new Blob(chunks, { 'type': 'audio/ogg; codecs=opus' });
                    chunks = [];
                    const audioURL = window.URL.createObjectURL(blob);
                    audio.src = audioURL;
                    console.log("recorder stopped");

                    playbutton.onclick = function (e) {
                        this.currentTime = 0;
                        audio.play();

                        document.all.playbutton.style.visibility="hidden";
                        document.all.pausebutton.style.visibility="visible";
                    }

                    pausebutton.onclick = function (e) {
                        audio.pause();

                        document.all.playbutton.style.visibility="visible";
                        document.all.pausebutton.style.visibility="hidden";
                    }

                    audio.addEventListener('canplay', function(e){
                        min = parseInt(recordTime/60);
                        sec = recordTime%60;

                        $("#timer").html(parseInt(min/10)+""+(min%10)+":"+parseInt(sec/10)+""+(sec%10));
                    });

                    audio.addEventListener('timeupdate', function(e){
                        var playtimeSec = Math.floor(audio.currentTime);
                        var playtimeMin = parseInt(playtimeSec/60);
                    
                        $("#timer").html(parseInt(playtimeMin/10)+""+(playtimeMin%10)+":"+parseInt(playtimeSec/10)+""+(playtimeSec%10));
                    }, false);

                    audio.addEventListener('ended', function() { 
                        document.all.playbutton.style.visibility="visible";
                        document.all.pausebutton.style.visibility="hidden";
                    }, false);

                    finalUploadButton.onclick = function (e) {
                        document.all.uploadCheckPop.style.visibility="hidden";
                        document.all.uploading.style.visibility = "visible";

                        /////////////////////////////////////////////
                        // 서버에 업로드해야 하는 구역
                        // audio.src 값이 오디오 소스값
                        /////////////////////////////////////////////
                        console.log("record file upload start");

                        ////////////////////////////////////////////
                        // 업로드 진행도는 실제 서버 작업할 때 수정하기
                        var upProgress = 0;
                        var UploadProgress = setInterval(function(){
                            $("#uploadProgress").html(upProgress+"%");
                            upProgress++;
                        }, 17);

                        setTimeout(function() {
                            clearInterval(UploadProgress);
                            setTimeout(function() {
                                console.log("record file upload done");
                                location.replace("./uploadDone.html");
                            }, 100);
                        }, 1700);
                        //////////////////////////////////////////////
                    }

                    deletebutton.onclick = function (e) {
                        audio.src = "none";
                        tryNum++;
                        $("#timer").html("00:00");
                        
                        // 삭제 팝업 애니메이션 제거
                        popUpFileElement.classList.remove('animate__animated', 'animate__zoomIn');
                        popUpUploadElement.classList.remove('animate__animated', 'animate__zoomIn');
                        popUpDeleteElement.classList.remove('animate__animated', 'animate__zoomIn');
                        popDownElement.classList.remove('animate__animated', 'animate__fadeInDown');

                        document.all.playbutton.style.visibility="hidden";
                        document.all.pausebutton.style.visibility="hidden";
                        document.all.deletePop.style.visibility="hidden";
                        document.all.backGround.style.visibility="hidden";
                        document.all.deletebuttonIcon.style.visibility="hidden";
                        document.all.dragdirection.style.visibility="hidden";
                        document.all.dragposition.style.visibility="hidden";
                        document.all.waterdrop.style.visibility="visible";
                        document.all.uploadbutton.style.visibility="visible";
                        document.all.recordbutton.style.visibility="visible";
                        document.all.recordpausebutton.style.visibility="hidden";
                        document.all.stopbutton.style.visibility="hidden";
                        document.all.timer.style.visibility="hidden";
                        
                        // 입히기 삭제 내용
                        document.all.swiperDiv.style.visibility="hidden";
                        document.all.dragup.style.bottom = "-100%";
                        document.all.dragwaterdrop.style.visibility = "hidden";
                        document.all.recordfinishpop.style.visibility = "hidden";
                        document.all.timer.style.opacity = 1;

                        swiper.activeIndex = 1;
                        swiper.slideReset();

                        console.log("record file deleted");
                    }
                }

                mediaRecorder.ondataavailable = function (e) {
                    chunks.push(e.data);
                }
            }

            let onError = function (err) {
                console.log('The following error occured: ' + err);
            }

            navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);

        } else {
            alert("해당 브라우저에서는 음성 녹음 기능을 지원하지 않습니다!");
            console.log('getUserMedia not supported on your browser!');
        }
    </script>
</body>
</html>